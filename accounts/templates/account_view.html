{% extends 'overall_template.html' %}
{% load i18n %}
{% load humanize %}
{% load money_overall %}

{% block title %}{{ account.name }} &bull; {% endblock %}

{% block pagetitle %}{{ account.name }}{% endblock %}

{% block extracss %}{{ transaction_form.media.css }}{% endblock %}
{% block extrajs %}{{ transaction_form.media.js }}{% endblock %}

{% block content %}
<table class="account horizontal">
	{% if account.number %}
	<tr>
		<th scope="row">{% trans "Account No." %}</th>
		<td>{{ account.number }}</td>
	</tr>
	{% endif %}
	{% if account.sort_code %}
	<tr>
		<th scope="row">{% trans "Account No." %}</th>
		<td>{{ account.sort_code }}</td>
	</tr>
	{% endif %}
	{% if account.track_balance %}
	<tr>
		<th scope="row">{% trans "Balance" %}</th>
		<td>{{ account.balance|currency:account.currency }}</td>
	</tr>
	{% endif %}
</table>
<form method="post" action="{{ request.url }}">
	<table class="transactions">
		<tbody>
			{% for t in transactions %}
			{% ifchanged t.date %}
			<tr>
				<th class="date" colspan="4">{{ t.date|naturalday|capfirst }}</th>
			</tr>
			{% endifchanged %}
			<tr class="{% cycle 'odd' 'even' %}">
				<td class="payee">
					<span class="sprite{% if t.mobile %} mobile" title="{% trans 'Entered from a mobile device' %}{% endif %}"></span>{{ t.payee.name }}
					{% if t.tags.all %}
					<div class="tags"><span class="sprite tag"></span>
						{% for tag in t.taglink_set.all %}
						{{ tag.tag.name }}{% if tag.split != t.amount %}:{{ tag.split }}{% endif %}
						{% endfor %}
					</div>
					{% endif %}
				</td>
				<td class="money{% if t.credit %} in{% endif %}">{{ t.amount|currency:account.currency }}</td>
				{% if account.track_balance %}<td class="money balance">{{ account.balance_at }}</td>{% endif %}
			</tr>
			{% empty %}
			<tr class="odd">
				<td colspan="{% if account.track_balance %}3{% else %}2{% endif %}">{% trans 'No transactions yet' %}</td>
			</tr>
			{% endfor %}
			<tr class="transaction_form">
				<td>
					<div class="date">{{ transaction_form.date.errors }}{{ transaction_form.date.label_tag }}{{ transaction_form.date }}</div>
					<div class="payee">{{ transaction_form.payee.errors }}{{ transaction_form.payee.label_tag }}{{ transaction_form.payee }}</div>
					<div class="tags"><span class="sprite tag"></span>{{ transaction_form.tags.errors }}{{ transaction_form.tags.label_tag }}{{ transaction_form.tags }}</div>
				</td>
				<td{% if account.track_balance %} colspan="2"{% endif %}>
					{{ transaction_form.amount.errors }}
					{{ transaction_form.amount.label_tag }}
					{{ transaction_form.amount }}
					<div class="credit">
						{{ transaction_form.credit.errors }}
						{{ transaction_form.credit }}
					</div>
					<div class="transfer">
						{{ transaction_form.transfer.errors }}
						{{ transaction_form.transfer.label_tag }}
						{{ transaction_form.transfer }}
					</div>
					<input type="submit" value="{% trans 'Save' %}"/>
				</td>
			</tr>
		</tbody>
	</table>
</form>
{% endblock content %}